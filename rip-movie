#!/bin/bash -

# Rip Movie
# =========
#
# Rip a movie from a DVD using Handbrake.
#
# Pass the mkv source file as the first option. By default this will be the name of the
# written output file, in $outputdir.
#
# `rip-movie -h` for more.

source _rip-disc

## Main logic

source="$*"
output_name="$source"

if [[ -z $1 ]] && ! "$use_TMDb"; then
    _report_error "no output file name found"
fi
if "$use_TMDb"; then
    output_name=$(find-movie "${source%.*}" 2>/dev/null).mkv
    if [[ $? -gt 0 ]]; then
        _report_error "Movie name not found in TMDb"
    fi
else
    if [[ "$(pwd)" == "${outputdir}" ]]; then
        _report_error "Attempting to overwrite source file. Change output directory. Exiting"
    fi
fi

_get_media_info "$source"

_set_video_settings

_set_audio_settings

HandBrakeCLI -i "$source" -t1 -o "${outputdir}/${output_name}" ${video_settings} ${audio_settings}
